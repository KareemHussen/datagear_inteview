<div class="transactions-container">
  <div class="transactions-header">
    <h2>Transactions</h2>
    <p-button 
      label="Create Transaction" 
      icon="pi pi-plus" 
      severity="primary"
      routerLink="/transactions/create">
    </p-button>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label for="type">Type</label>
        <p-select 
          id="type"
          [options]="typeOptions" 
          [(ngModel)]="typeFilter"
          (onChange)="onFilterChange()"
          placeholder="Select type">
        </p-select>
      </div>
      
      <div class="filter-group">
        <label for="dateRange">Date Range</label>
        <p-datepicker
          [(ngModel)]="dateRange"
          selectionMode="range"
          [showTime]="true"
          hourFormat="12"
          [showSeconds]="false"
          [readonlyInput]="true"
          [touchUI]="true"
          placeholder="Select date & time range"
          (onSelect)="onFilterChange()">
        </p-datepicker>
      </div>
      
      <div class="filter-actions">
        <p-button 
          label="Clear Filters" 
          icon="pi pi-times" 
          severity="secondary"
          size="small"
          (onClick)="clearFilters()">
        </p-button>
      </div>
    </div>
  </div>


  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="table-skeleton">
        <p-skeleton height="400px"></p-skeleton>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="error-container">
      <p-message 
        severity="error" 
        [text]="error()!" 
        [closable]="false">
      </p-message>
      <p-button 
        label="Retry" 
        icon="pi pi-refresh" 
        severity="secondary"
        (onClick)="performLoad()"
        class="retry-button">
      </p-button>
    </div>
  }

  <!-- Transactions Table -->
  @if (!loading() && !error()) {
    <div class="table-container">
      <p-table 
        [value]="transactions()" 
        [paginator]="false"
        [sortField]="sortField()"
        [sortOrder]="sortOrder()"
        (onSort)="onSort($event)"
        [loading]="loading()"
        styleClass="transactions-table">
        
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="createdAt">
              Date
              <p-sortIcon field="date"></p-sortIcon>
            </th>
            <th pSortableColumn="note">
              Note
              <p-sortIcon field="note"></p-sortIcon>
            </th>
            <th pSortableColumn="type">
              Type
              <p-sortIcon field="type"></p-sortIcon>
            </th>
            <th pSortableColumn="amount">
              Amount
              <p-sortIcon field="amount"></p-sortIcon>
            </th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-transaction>
          <tr>
            <td>{{ formatDate(transaction.createdAt) }}</td>
            <td>{{ transaction.note }}</td>
            <td>
              <p-tag 
                [value]="getTransactionTypeLabel(transaction.type)"
                [severity]="getTransactionTypeSeverity(transaction.type)">
              </p-tag>
            </td>
            
            <td [ngClass]="transaction.type === 'Credit' ? 'credit-amount' : 'debit-amount'">
              {{ formatCurrency(transaction.amount) }}
            </td>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="empty-message">
              <div class="empty-state">
                <i class="pi pi-inbox" style="font-size: 3rem; color: var(--text-color-secondary);"></i>
                <h3>No transactions found</h3>
                <p>Try adjusting your filters or create a new transaction.</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <!-- Pagination -->
      <p-paginator 
        [rows]="pageSize()"
        [totalRecords]="totalRecords()"
        [first]="first()"
        (onPageChange)="onPageChange($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[5, 10, 20, 50]">
      </p-paginator>
    </div>
  }
</div>